import React, { useState } from 'react';
import Modal from 'react-modal';
import DatePicker from 'react-datepicker';
import 'react-datepicker/dist/react-datepicker.css';
import CommonSelect from './CommonSelect'; // Assuming this component is available

Modal.setAppElement('#root'); // Set the app element for accessibility

const ExamApp = () => {
  const [exams, setExams] = useState([]);
  const [modalIsOpen, setModalIsOpen] = useState(false);
  const [examID, setExamID] = useState('');
  const [examName, setExamName] = useState('');
  const [examDate, setExamDate] = useState(null);
  const [startTime, setStartTime] = useState('');
  const [endTime, setEndTime] = useState('');

  const handleAddExam = (e) => {
    e.preventDefault();
    const newExam = {
      id: examID,
      examName,
      examDate,
      startTime,
      endTime,
    };

    setExams([...exams, newExam]);
    closeModal(); // Close the modal after adding the exam
  };

  const openModal = () => {
    setModalIsOpen(true);
  };

  const closeModal = () => {
    setModalIsOpen(false);
    // Reset form values
    setExamID('');
    setExamName('');
    setExamDate(null);
    setStartTime('');
    setEndTime('');
  };

  return (
    <div className="container">
      <h1>Exam Tracker</h1>
      <button className="btn btn-primary" onClick={openModal}>
        Add Exam
      </button>

      <Modal isOpen={modalIsOpen} onRequestClose={closeModal}>
        <h2>Add Exam</h2>
        <form onSubmit={handleAddExam}>
          <div className="mb-3">
            <label className="form-label">ID</label>
            <input
              type="text"
              className="form-control"
              value={examID}
              onChange={(e) => setExamID(e.target.value)}
              required
            />
          </div>
          <div className="mb-3">
            <label className="form-label">Exam Name</label>
            <input
              type="text"
              className="form-control"
              value={examName}
              onChange={(e) => setExamName(e.target.value)}
              required
            />
          </div>
          <div className="mb-3">
            <label className="form-label">Exam Date</label>
            <DatePicker
              className="form-control"
              selected={examDate}
              onChange={(date) => setExamDate(date)}
              dateFormat="dd-MM-yyyy"
              placeholderText="Select a date"
              required
            />
          </div>
          <div className="mb-3">
            <label className="form-label">Start Time</label>
            <CommonSelect
              className="select"
              options={startTime}
              onChange={(value) => setStartTime(value)}
              required
            />
          </div>
          <div className="mb-0">
            <label className="form-label">End Time</label>
            <CommonSelect
              className="select"
              options={endTime}
              onChange={(value) => setEndTime(value)}
              required
            />
          </div>
          <div className="modal-footer">
            <button type="button" className="btn btn-light me-2" onClick={closeModal}>
              Cancel
            </button>
            <button type="submit" className="btn btn-primary">
              Add Exam
            </button>
          </div>
        </form>
      </Modal>

      {/* Display Exams Table */}
      {exams.length > 0 && (
        <table className="table mt-4">
          <thead>
            <tr>
              <th>ID</th>
              <th>Exam Name</th>
              <th>Exam Date</th>
              <th>Start Time</th>
              <th>End Time</th>
            </tr>
          </thead>
          <tbody>
            {exams.map((exam, index) => (
              <tr key={index}>
                <td>{exam.id}</td>
                <td>{exam.examName}</td>
                <td>{exam.examDate ? exam.examDate.toLocaleDateString() : ''}</td>
                <td>{exam.startTime}</td>
                <td>{exam.endTime}</td>
              </tr>
            ))}
          </tbody>
        </table>
      )}
    </div>
  );
};

export default ExamApp;
