import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import DatePicker from 'react-datepicker';
import CommonSelect from './CommonSelect';
import 'react-datepicker/dist/react-datepicker.css';

// Define the type for an Exam
interface ExamDetails {
  name: string;
  date: Date | null;
  startTime: string;
  endTime: string;
}

const Exam: React.FC = () => {
  // State to hold exams
  const [exams, setExams] = useState<ExamDetails[]>([]);
  const [examDetails, setExamDetails] = useState<ExamDetails>({
    name: '',
    date: null,
    startTime: '',
    endTime: '',
  });

  const [isEditing, setIsEditing] = useState(false);
  const [editIndex, setEditIndex] = useState<number | null>(null);

  // Function to handle adding an exam
  const handleAddExam = (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();

    if (isEditing && editIndex !== null) {
      // Update existing exam
      const updatedExams = [...exams];
      updatedExams[editIndex] = examDetails;
      setExams(updatedExams);
      setIsEditing(false);
      setEditIndex(null);
    } else {
      // Add new exam
      setExams([...exams, examDetails]);
    }

    // Reset form
    setExamDetails({ name: '', date: null, startTime: '', endTime: '' });
  };

  // Function to handle input changes
  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setExamDetails({ ...examDetails, [name]: value });
  };

  const handleDateChange = (date: Date | null) => {
    setExamDetails({ ...examDetails, date });
  };

  // Function to start editing an exam
  const handleEditExam = (index: number) => {
    setExamDetails(exams[index]);
    setIsEditing(true);
    setEditIndex(index);
  };

  // Function to delete an exam
  const handleDeleteExam = (index: number) => {
    const updatedExams = exams.filter((_, i) => i !== index);
    setExams(updatedExams);
  };

  return (
    <div>
      {/* Add Exam Modal */}
      <div className="modal fade" id="add_exam">
        <div className="modal-dialog modal-dialog-centered">
          <div className="modal-content">
            <div className="modal-header">
              <h4 className="modal-title">{isEditing ? 'Edit Exam' : 'Add Exam'}</h4>
              <button
                type="button"
                className="btn-close custom-btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              >
                <i className="ti ti-x" />
              </button>
            </div>
            <form onSubmit={handleAddExam}>
              <div className="modal-body">
                <div className="row">
                  <div className="col-md-12">
                    <div className="mb-3">
                      <label className="form-label">Exam Name</label>
                      <input
                        type="text"
                        className="form-control"
                        name="name"
                        value={examDetails.name}
                        onChange={handleInputChange}
                        required
                      />
                    </div>
                    <div className="mb-3">
                      <label className="form-label">Exam Date</label>
                      <div className="date-pic">
                        <DatePicker
                          className="form-control datetimepicker"
                          selected={examDetails.date}
                          onChange={handleDateChange}
                          placeholderText="16 May 2024"
                          required
                        />
                        <span className="cal-icon">
                          <i className="ti ti-calendar" />
                        </span>
                      </div>
                    </div>
                    <div className="mb-3">
                      <label className="form-label">Start Time</label>
                      <CommonSelect
                        className="select"
                        options={startTime} // Ensure startTime has appropriate values
                        onChange={(option: { value: string }) => setExamDetails({ ...examDetails, startTime: option.value })}
                        value={examDetails.startTime}
                      />
                    </div>
                    <div className="mb-0">
                      <label className="form-label">End Time</label>
                      <CommonSelect
                        className="select"
                        options={startTimeOne} // Ensure startTimeOne has appropriate values
                        onChange={(option: { value: string }) => setExamDetails({ ...examDetails, endTime: option.value })}
                        value={examDetails.endTime}
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div className="modal-footer">
                <Link to="#" className="btn btn-light me-2" data-bs-dismiss="modal">
                  Cancel
                </Link>
                <button type="submit" className="btn btn-primary">
                  {isEditing ? 'Edit Exam' : 'Add Exam'}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      {/* Display Exams */}
      <div>
        <h3>Exams List</h3>
        <ul>
          {exams.map((exam, index) => (
            <li key={index}>
              {exam.name} - {exam.date ? exam.date.toLocaleDateString() : ''} - {exam.startTime} to {exam.endTime}
              <button onClick={() => handleEditExam(index)} className="btn btn-warning btn-sm ms-2">
                Edit
              </button>
              <button onClick={() => handleDeleteExam(index)} className="btn btn-danger btn-sm ms-2">
                Delete
              </button>
            </li>
          ))}
        </ul>
      </div>

      {/* Modal for Delete Confirmation */}
      <div className="modal fade" id="delete-modal">
        <div className="modal-dialog modal-dialog-centered">
          <div className="modal-content">
            <div className="modal-body text-center">
              <i className="ti ti-trash-x fs-50 my-3 text-danger" />
              <h4>Are you sure you want to delete this exam?</h4>
              <div className="d-flex justify-content-center">
                <Link className="btn btn-light me-3" to="#" data-bs-dismiss="modal">
                  Cancel
                </Link>
                <Link className="btn btn-primary" to="#" data-bs-dismiss="modal">
                  Delete
                </Link>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Exam;
